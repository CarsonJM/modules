nextflow_function {

    name "Test getWorkDirs"
    script "../main.nf"

    test("getWorkDirs single") {
        function "getWorkDirs"
        when {
            function {
            """
            input[0] = Channel.of(
                [
                    [ id:'test' ], // meta map
                    "/somepath/work/12/hashforworkdirtoclean/somefile.txt"
                ]
            )
            input[1] = Channel.of(
                [
                    [ id:'test' ], // meta map
                    "/somepath/work/34/hashforworkdirdownstream/someotherfile.txt"
                ]
            )
            input[2] = true
            """
            }
        }
        then {
            assertAll (
                { assert function.success },
                { assert function.stdout.any() { it.contains("[[id:test], /somepath/work/12/hashforworkdirtoclean/]") } },
                { assert function.stdout.any() { !it.contains("/somepath/work/34/hashforworkdirdownstream/") } }
            )
        }
    }

    test("getWorkDirs double") {
        function "getWorkDirs"
        when {
            function {
            """
            input[0] = Channel.of(
                [
                    [ id:'test' ], // meta map
                    "/somepath/work/12/hashforworkdirtoclean/somefile.txt"
                ],
                [
                    [ id:'test' ], // meta map
                    "/somepath/work/24/hashforworkdirtoclean/somefile.txt"
                ]
            )
            input[1] = Channel.of(
                [
                    [ id:'test' ], // meta map
                    "/somepath/work/34/hashforworkdirdownstream/someotherfile.txt"
                ]
            )
            input[2] = true
            """
            }
        }
        then {
            assertAll (
                { assert function.success },
                { assert function.stdout.any() { it.contains("[[id:test], /somepath/work/12/hashforworkdirtoclean/]") } },
                { assert function.stdout.any() { it.contains("[[id:test], /somepath/work/24/hashforworkdirtoclean/]") } },
                { assert function.stdout.any() { !it.contains("/somepath/work/34/hashforworkdirdownstream/") } }
            )
        }
    }
}